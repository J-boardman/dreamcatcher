import{s as T,e as P,i as p,d as u,w as j,o as H,b as L,p as Z,f as _,a as S,g,h as A,c as E,D as F,j as w,A as I,S as tt,v as y,B as W}from"../chunks/scheduler.3b07f987.js";import{S as D,i as J,g as z,t as $,c as K,a as h,b as x,d as k,m as C,e as N}from"../chunks/index.c72e2f07.js";import{n as O,p as et}from"../chunks/stores.b4316504.js";import{i as Q,a as nt}from"../chunks/index.d3367806.js";import{e as U}from"../chunks/Title.49fc599e.js";import{S as ot}from"../chunks/StoryCard.6cd06b38.js";import{a as rt,g as st}from"../chunks/navigation.c51359bf.js";import{p as R}from"../chunks/stores.2d407fbe.js";import{c as lt,h as at}from"../chunks/journal.b7415717.js";import{C as it}from"../chunks/create.64ec9803.js";import{B as q}from"../chunks/BottomAction.c6430b9f.js";import{B as ct}from"../chunks/BottomActions.a1fe9458.js";function ft(i,t,n){const e=i.slice();return e[11]=t[n],e}function ut(i){let t,n,e,a,s,o="No stories left...",l,r,f="Why not start one of your own?",c,d,B;return e=new it({props:{class:"text-7xl"}}),{c(){t=_("section"),n=_("button"),x(e.$$.fragment),a=S(),s=_("p"),s.textContent=o,l=S(),r=_("p"),r.textContent=f,this.h()},l(b){t=g(b,"SECTION",{class:!0});var m=A(t);n=g(m,"BUTTON",{class:!0});var v=A(n);k(e.$$.fragment,v),a=E(v),s=g(v,"P",{"data-svelte-h":!0}),F(s)!=="svelte-1vbx0y5"&&(s.textContent=o),l=E(v),r=g(v,"P",{"data-svelte-h":!0}),F(r)!=="svelte-tpeu84"&&(r.textContent=f),v.forEach(u),m.forEach(u),this.h()},h(){w(n,"class","grid place-items-center duration-200 hover:text-secondary mb-16 py-8 w-full rounded-xl"),w(t,"class","flex justify-center items-center gap-2 text-lg bg-secondary-content/80 rounded-xl")},m(b,m){p(b,t,m),I(t,n),C(e,n,null),I(n,a),I(n,s),I(n,l),I(n,r),c=!0,d||(B=tt(n,"click",i[2]),d=!0)},p:y,i(b){c||(h(e.$$.fragment,b),c=!0)},o(b){$(e.$$.fragment,b),c=!1},d(b){b&&u(t),N(e),d=!1,B()}}}function mt(i){let t,n,e,a=U(Array(3)),s=[];for(let o=0;o<a.length;o+=1)s[o]=pt(ft(i,a,o));return{c(){t=_("div"),n=S();for(let o=0;o<s.length;o+=1)s[o].c();e=P(),this.h()},l(o){t=g(o,"DIV",{class:!0}),A(t).forEach(u),n=E(o);for(let l=0;l<s.length;l+=1)s[l].l(o);e=P(),this.h()},h(){w(t,"class","w-full h-full bg-secondary-content/80 skeleton")},m(o,l){p(o,t,l),i[6](t),p(o,n,l);for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(o,l);p(o,e,l)},p:y,i:y,o:y,d(o){o&&(u(t),u(n),u(e)),i[6](null),W(s,o)}}}function pt(i){let t;return{c(){t=_("div"),this.h()},l(n){t=g(n,"DIV",{class:!0}),A(t).forEach(u),this.h()},h(){w(t,"class","h-full w-full bg-secondary-content/80 skeleton")},m(n,e){p(n,t,e)},p:y,d(n){n&&u(t)}}}function ht(i){let t,n,e,a;const s=[mt,ut],o=[];function l(r,f){return r[0]?0:1}return t=l(i),n=o[t]=s[t](i),{c(){n.c(),e=P()},l(r){n.l(r),e=P()},m(r,f){o[t].m(r,f),p(r,e,f),a=!0},p(r,[f]){let c=t;t=l(r),t===c?o[t].p(r,f):(z(),$(o[c],1,1,()=>{o[c]=null}),K(),n=o[t],n?n.p(r,f):(n=o[t]=s[t](r),n.c()),h(n,1),n.m(e.parentNode,e))},i(r){a||(h(n),a=!0)},o(r){$(n),a=!1},d(r){r&&u(e),o[t].d(r)}}}function $t(i,t,n){let e,a,s,o;j(i,O,m=>n(4,s=m)),j(i,R,m=>n(5,o=m));let l=!0,r,f;H(async()=>{n(0,l=await c()),r=new IntersectionObserver(d,{rootMargin:"1px",threshold:0}),f&&r.observe(f)}),L(()=>{f&&r&&r.observe(f)}),rt(async()=>{n(0,l=await c())});async function c(){const m=await fetch("/api/stories/count/"+e),{storyCount:v}=await m.json();return s.length<v}async function d(m){if(m.some(M=>M.isIntersecting)){if(console.log("ping"),!l)return;const M=await fetch(`/api/stories/${a}`),{stories:X}=await M.json();O.update(Y=>[...Y,...X]),n(0,l=await c())}}function B(){const m=lt();st(`/journal/${m.id}`)}function b(m){Z[m?"unshift":"push"](()=>{f=m,n(1,f)})}return i.$$.update=()=>{i.$$.dirty&32&&n(3,e=Q(o.url)?"?filter=following&":"?"),i.$$.dirty&24&&(a=e+`skip=${s.length}`)},[l,f,B,e,s,o,b]}class _t extends D{constructor(t){super(),J(this,t,$t,ht,T,{})}}function V(i,t,n){const e=i.slice();return e[1]=t[n],e}function G(i){let t,n,e,a;return n=new ot({props:{story:i[1]}}),{c(){t=_("a"),x(n.$$.fragment),this.h()},l(s){t=g(s,"A",{href:!0});var o=A(t);k(n.$$.fragment,o),o.forEach(u),this.h()},h(){var s;w(t,"href",e="/story/"+((s=i[1])==null?void 0:s.id))},m(s,o){p(s,t,o),C(n,t,null),a=!0},p(s,o){var r;const l={};o&1&&(l.story=s[1]),n.$set(l),(!a||o&1&&e!==(e="/story/"+((r=s[1])==null?void 0:r.id)))&&w(t,"href",e)},i(s){a||(h(n.$$.fragment,s),a=!0)},o(s){$(n.$$.fragment,s),a=!1},d(s){s&&u(t),N(n)}}}function gt(i){let t,n,e,a,s=U(i[0]),o=[];for(let r=0;r<s.length;r+=1)o[r]=G(V(i,s,r));const l=r=>$(o[r],1,1,()=>{o[r]=null});return e=new _t({}),{c(){t=_("section");for(let r=0;r<o.length;r+=1)o[r].c();n=S(),x(e.$$.fragment),this.h()},l(r){t=g(r,"SECTION",{class:!0});var f=A(t);for(let c=0;c<o.length;c+=1)o[c].l(f);n=E(f),k(e.$$.fragment,f),f.forEach(u),this.h()},h(){w(t,"class","my-2 grid sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4 auto-rows-fr")},m(r,f){p(r,t,f);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(t,null);I(t,n),C(e,t,null),a=!0},p(r,[f]){if(f&1){s=U(r[0]);let c;for(c=0;c<s.length;c+=1){const d=V(r,s,c);o[c]?(o[c].p(d,f),h(o[c],1)):(o[c]=G(d),o[c].c(),h(o[c],1),o[c].m(t,n))}for(z(),c=s.length;c<o.length;c+=1)l(c);K()}},i(r){if(!a){for(let f=0;f<s.length;f+=1)h(o[f]);h(e.$$.fragment,r),a=!0}},o(r){o=o.filter(Boolean);for(let f=0;f<o.length;f+=1)$(o[f]);$(e.$$.fragment,r),a=!1},d(r){r&&u(t),W(o,r),N(e)}}}function dt(i,t,n){let e;return j(i,O,a=>n(0,e=a)),[e]}class bt extends D{constructor(t){super(),J(this,t,dt,gt,T,{})}}function wt(i){let t,n="Global";return{c(){t=_("span"),t.textContent=n,this.h()},l(e){t=g(e,"SPAN",{slot:!0,"data-svelte-h":!0}),F(t)!=="svelte-9jbwhk"&&(t.textContent=n),this.h()},h(){w(t,"slot","label")},m(e,a){p(e,t,a)},p:y,d(e){e&&u(t)}}}function vt(i){let t,n="Following";return{c(){t=_("span"),t.textContent=n,this.h()},l(e){t=g(e,"SPAN",{slot:!0,"data-svelte-h":!0}),F(t)!=="svelte-2yvu6u"&&(t.textContent=n),this.h()},h(){w(t,"slot","label")},m(e,a){p(e,t,a)},p:y,d(e){e&&u(t)}}}function yt(i){let t,n="New Journal";return{c(){t=_("span"),t.textContent=n,this.h()},l(e){t=g(e,"SPAN",{slot:!0,"data-svelte-h":!0}),F(t)!=="svelte-56mq0o"&&(t.textContent=n),this.h()},h(){w(t,"slot","label")},m(e,a){p(e,t,a)},p:y,d(e){e&&u(t)}}}function xt(i){let t,n,e,a,s,o;return t=new q({props:{link:"/feed",active:!i[0],icon:"fluent-mdl2:world",$$slots:{label:[wt]},$$scope:{ctx:i}}}),e=new q({props:{link:"/feed?filter=following",active:i[0],icon:"ph:user-bold",$$slots:{label:[vt]},$$scope:{ctx:i}}}),s=new q({props:{action:at,icon:"system-uicons:create",$$slots:{label:[yt]},$$scope:{ctx:i}}}),{c(){x(t.$$.fragment),n=S(),x(e.$$.fragment),a=S(),x(s.$$.fragment)},l(l){k(t.$$.fragment,l),n=E(l),k(e.$$.fragment,l),a=E(l),k(s.$$.fragment,l)},m(l,r){C(t,l,r),p(l,n,r),C(e,l,r),p(l,a,r),C(s,l,r),o=!0},p(l,r){const f={};r&1&&(f.active=!l[0]),r&4&&(f.$$scope={dirty:r,ctx:l}),t.$set(f);const c={};r&1&&(c.active=l[0]),r&4&&(c.$$scope={dirty:r,ctx:l}),e.$set(c);const d={};r&4&&(d.$$scope={dirty:r,ctx:l}),s.$set(d)},i(l){o||(h(t.$$.fragment,l),h(e.$$.fragment,l),h(s.$$.fragment,l),o=!0)},o(l){$(t.$$.fragment,l),$(e.$$.fragment,l),$(s.$$.fragment,l),o=!1},d(l){l&&(u(n),u(a)),N(t,l),N(e,l),N(s,l)}}}function kt(i){let t,n;return t=new ct({props:{$$slots:{default:[xt]},$$scope:{ctx:i}}}),{c(){x(t.$$.fragment)},l(e){k(t.$$.fragment,e)},m(e,a){C(t,e,a),n=!0},p(e,[a]){const s={};a&5&&(s.$$scope={dirty:a,ctx:e}),t.$set(s)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){$(t.$$.fragment,e),n=!1},d(e){N(t,e)}}}function Ct(i,t,n){let e,a;return j(i,R,s=>n(1,a=s)),i.$$.update=()=>{i.$$.dirty&2&&n(0,e=Q(a.url))},[e,a]}class Nt extends D{constructor(t){super(),J(this,t,Ct,kt,T,{})}}function St(i){let t,n,e,a,s;return n=new bt({}),a=new Nt({}),{c(){t=_("main"),x(n.$$.fragment),e=S(),x(a.$$.fragment),this.h()},l(o){t=g(o,"MAIN",{class:!0});var l=A(t);k(n.$$.fragment,l),l.forEach(u),e=E(o),k(a.$$.fragment,o),this.h()},h(){w(t,"class","md:mx-4 mb-16 md:mb-24 flex-1 grid")},m(o,l){p(o,t,l),C(n,t,null),p(o,e,l),C(a,o,l),s=!0},p:y,i(o){s||(h(n.$$.fragment,o),h(a.$$.fragment,o),s=!0)},o(o){$(n.$$.fragment,o),$(a.$$.fragment,o),s=!1},d(o){o&&(u(t),u(e)),N(n),N(a,o)}}}function At(i,t,n){let{data:e}=t;return H(()=>{et.set("Dreamcatcher"),nt()}),L(()=>{O.set(e.stories)}),i.$$set=a=>{"data"in a&&n(0,e=a.data)},[e]}class Ut extends D{constructor(t){super(),J(this,t,At,St,T,{data:0})}}export{Ut as component};
