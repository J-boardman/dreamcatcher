import{s as ie,x as Se,J as rt,K as ot,L as at,h as $,M as it,d as _,N as Pe,i as k,v as V,y as Le,f as b,g as v,j as g,w as A,o as ct,a as D,c as G,A as p,D as F,z as we,S as q,V as Te,l as Z,m as Q,n as ke,B as Re,b as ut,e as ae,p as ft,U as B,W as yt,X as xe,q as qe,Y as Tt}from"../chunks/scheduler.24c66ff4.js";import{S as ce,i as ue,g as Ie,t as R,c as Ce,a as P,b as j,d as X,m as H,e as W}from"../chunks/index.175ea22e.js";import{e as ve,T as It}from"../chunks/Title.2ff95952.js";import{j as oe,s as fe,f as $e,p as Ct}from"../chunks/stores.745d342d.js";import{a as dt,g as $t}from"../chunks/navigation.ce6aac00.js";import{I as mt,B as St}from"../chunks/BottomActions.149efee8.js";import{M as ht}from"../chunks/Modal.3face22c.js";import{g as pt}from"../chunks/spread.8a54911c.js";import{b as _t,g as be}from"../chunks/index.6dac0e4f.js";import{u as te,s as wt,a as ze}from"../chunks/journal.fde605b2.js";import{c as gt}from"../chunks/index.793d310b.js";import{h as bt}from"../chunks/handleFetch.03113381.js";import{I as Oe}from"../chunks/Icon.1947aee0.js";function Ne(r,e="hidden message"){return{role:"system",id:Math.random().toString(36).substring(2,9),content:r,name:e}}async function vt(r,e){try{return[await(await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...e,Ne(r)],streaming:!1})})).json(),null]}catch(n){return[null,n]}}const kt=(r,e)=>`Please create a long, ${r}, fantastical bedtime story set in a ${e} setting based on your previous dream interpretation. Do not include a title as this will be generated later. If there has been no previous dream interpretation, start a story based on a random setting `+_t(),Nt=(r,e)=>`Please write the first chapter of a "choose your own adventure" style, ${r}, fantastical bedtime story set in a ${e} setting.The story should be based on your previous dream interpretation. Do not include a title as this will be generated later. Make the chapters short and descriptive. After writing your chapter, provide the user with three options to continue the story (Always preface this with a line saying "Choose your path:"). Write the next chapter when they respond with an option or their own custom instruction. Continuing doing this until the user responds with "Wrap it up", where you will wrap up the story in the following chapter. Do not acknowledge this message, just start the story now.`,Et="A tall full length portrait oriented image 1792px high by 1024px wide. 4k, detailed, trending in artstation, studio ghibli, fantastical.",Ot="Create a short 50 word prompt for AI image generation based on the story, vividly describing the protagonist and plot: ",xt="Please create one final dream interpretation based on the dream with the added context of the conversation so far.";async function Pt(r,e,n){const t=`${Ot}. The image should be ${e} and set in ${n}.`,[s,l]=await vt(t,r);return l||`${s==null?void 0:s.choices[0].message.content}`}function Lt({params:r}){return{id:r.id}}const Xn=Object.freeze(Object.defineProperty({__proto__:null,load:Lt},Symbol.toStringTag,{value:"Module"}));function Rt(r){let e,n,t='<path fill="currentColor" d="M11 17h2v-6h-2zm1-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22"/>',s=[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},r[0]],l={};for(let o=0;o<s.length;o+=1)l=Se(l,s[o]);return{c(){e=rt("svg"),n=new ot(!0),this.h()},l(o){e=at(o,"svg",{viewBox:!0,width:!0,height:!0});var a=$(e);n=it(a,!0),a.forEach(_),this.h()},h(){n.a=null,Pe(e,l)},m(o,a){k(o,e,a),n.m(t,e)},p(o,[a]){Pe(e,l=pt(s,[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},a&1&&o[0]]))},i:V,o:V,d(o){o&&_(e)}}}function At(r,e,n){return r.$$set=t=>{n(0,e=Se(Se({},e),Le(t)))},e=Le(e),[e]}class Mt extends ce{constructor(e){super(),ue(this,e,At,Rt,ie,{})}}function Dt(r){let e,n,t;return n=new mt({props:{message:"image expired."}}),{c(){e=b("div"),j(n.$$.fragment),this.h()},l(s){e=v(s,"DIV",{class:!0});var l=$(e);X(n.$$.fragment,l),l.forEach(_),this.h()},h(){g(e,"class","w-64 md:w-96 chat-bubble bg-base-300")},m(s,l){k(s,e,l),H(n,e,null),t=!0},p:V,i(s){t||(P(n.$$.fragment,s),t=!0)},o(s){R(n.$$.fragment,s),t=!1},d(s){s&&_(e),W(n)}}}function Gt(r){let e,n,t,s,l,o,a;function i(m,y){return m[0].content=="Generating Image"?Bt:Vt}let c=i(r),d=c(r);function u(m,y){return m[0].content=="Generating Image"?Ut:Ft}let h=u(r),f=h(r);return l=new ht({props:{buttonText:"",classes:"btn-ghost btn-sm btn-circle",$$slots:{title:[Yt],logo:[zt],default:[qt]},$$scope:{ctx:r}}}),{c(){e=b("figure"),d.c(),n=D(),t=b("div"),f.c(),s=D(),j(l.$$.fragment),this.h()},l(m){e=v(m,"FIGURE",{class:!0});var y=$(e);d.l(y),n=G(y),t=v(y,"DIV",{class:!0});var T=$(t);f.l(T),s=G(T),X(l.$$.fragment,T),T.forEach(_),y.forEach(_),this.h()},h(){var m,y;g(t,"class","flex items-center justify-between p-2 bg-secondary-content rounded-b-xl -mt-2"),g(e,"class",o="chat-bubble py-4 "+(r[0].content==((y=(m=r[2])==null?void 0:m.image)==null?void 0:y.url)?"bg-secondary":"bg-base-300"))},m(m,y){k(m,e,y),d.m(e,null),p(e,n),p(e,t),f.m(t,null),p(t,s),H(l,t,null),a=!0},p(m,y){var C,O;c===(c=i(m))&&d?d.p(m,y):(d.d(1),d=c(m),d&&(d.c(),d.m(e,n))),h===(h=u(m))&&f?f.p(m,y):(f.d(1),f=h(m),f&&(f.c(),f.m(t,s)));const T={};y&512&&(T.$$scope={dirty:y,ctx:m}),l.$set(T),(!a||y&5&&o!==(o="chat-bubble py-4 "+(m[0].content==((O=(C=m[2])==null?void 0:C.image)==null?void 0:O.url)?"bg-secondary":"bg-base-300")))&&g(e,"class",o)},i(m){a||(P(l.$$.fragment,m),a=!0)},o(m){R(l.$$.fragment,m),a=!1},d(m){m&&_(e),d.d(),f.d(),W(l)}}}function Vt(r){let e,n,t,s,l;return{c(){e=b("button"),n=b("img"),this.h()},l(o){e=v(o,"BUTTON",{});var a=$(e);n=v(a,"IMG",{src:!0,alt:!0,class:!0}),a.forEach(_),this.h()},h(){we(n.src,t=r[0].content)||g(n,"src",t),g(n,"alt","cover"),g(n,"class","w-96 rounded-t-xl")},m(o,a){k(o,e,a),p(e,n),s||(l=[q(n,"error",r[5]),q(e,"click",r[4])],s=!0)},p(o,a){a&1&&!we(n.src,t=o[0].content)&&g(n,"src",t)},d(o){o&&_(e),s=!1,Te(l)}}}function Bt(r){let e;return{c(){e=b("div"),this.h()},l(n){e=v(n,"DIV",{class:!0}),$(e).forEach(_),this.h()},h(){g(e,"class","w-64 h-96 rounded-t-xl bg-base-200 skeleton")},m(n,t){k(n,e,t)},p:V,d(n){n&&_(e)}}}function Ft(r){let e,n,t;return{c(){e=b("p"),n=Z(r[1]),t=Z(" until your image expires.")},l(s){e=v(s,"P",{});var l=$(e);n=Q(l,r[1]),t=Q(l," until your image expires."),l.forEach(_)},m(s,l){k(s,e,l),p(e,n),p(e,t)},p(s,l){l&2&&ke(n,s[1])},d(s){s&&_(e)}}}function Ut(r){let e,n="Generating your image";return{c(){e=b("p"),e.textContent=n},l(t){e=v(t,"P",{"data-svelte-h":!0}),F(e)!=="svelte-115f7le"&&(e.textContent=n)},m(t,s){k(t,e,s)},p:V,d(t){t&&_(e)}}}function qt(r){let e,n="Images are generated from Open AI's DALLE-3 image generation model.";return{c(){e=b("p"),e.textContent=n},l(t){e=v(t,"P",{"data-svelte-h":!0}),F(e)!=="svelte-9d8l4z"&&(e.textContent=n)},m(t,s){k(t,e,s)},p:V,d(t){t&&_(e)}}}function zt(r){let e,n;return e=new Mt({props:{class:"text-2xl text-primary"}}),{c(){j(e.$$.fragment)},l(t){X(e.$$.fragment,t)},m(t,s){H(e,t,s),n=!0},p:V,i(t){n||(P(e.$$.fragment,t),n=!0)},o(t){R(e.$$.fragment,t),n=!1},d(t){W(e,t)}}}function Yt(r){let e,n="About Image Generation";return{c(){e=b("h2"),e.textContent=n,this.h()},l(t){e=v(t,"H2",{slot:!0,class:!0,"data-svelte-h":!0}),F(e)!=="svelte-7s6nc5"&&(e.textContent=n),this.h()},h(){g(e,"slot","title"),g(e,"class","text-3xl")},m(t,s){k(t,e,s)},p:V,d(t){t&&_(e)}}}function jt(r){let e,n,t,s;const l=[Gt,Dt],o=[];function a(i,c){return i[0].content?0:1}return n=a(r),t=o[n]=l[n](r),{c(){e=b("article"),t.c(),this.h()},l(i){e=v(i,"ARTICLE",{class:!0});var c=$(e);t.l(c),c.forEach(_),this.h()},h(){g(e,"class","chat chat-start")},m(i,c){k(i,e,c),o[n].m(e,null),s=!0},p(i,[c]){let d=n;n=a(i),n===d?o[n].p(i,c):(Ie(),R(o[d],1,1,()=>{o[d]=null}),Ce(),t=o[n],t?t.p(i,c):(t=o[n]=l[n](i),t.c()),P(t,1),t.m(e,null))},i(i){s||(P(t),s=!0)},o(i){R(t),s=!1},d(i){i&&_(e),o[n].d()}}}function Ht(r,e,n){let t,s,l;A(r,oe,h=>n(2,l=h));let{message:o}=e;const{setMessages:a,messages:i}=be();A(r,i,h=>n(6,s=h));function c(){var h;o.content!=((h=l==null?void 0:l.image)==null?void 0:h.url)&&(te({image:{...l.image,url:o.content}}),a([...s,Ne("_","Cover Image updated")]))}function d(){setInterval(()=>{let h=new Date().getTime()-new Date(o.id).getTime(),f=3600-Math.round(h/1e3),m=Math.floor(f/60),y=Math.round(f%60),T=y<10?`0${y}`:y;f<0?n(1,t="0:00"):n(1,t=`${m}:${T}`)},1e3)}ct(()=>{d()});const u=()=>{te({image:{url:"",created:""}}),n(0,o.content="",o)};return r.$$set=h=>{"message"in h&&n(0,o=h.message)},n(1,t="0:00"),[o,t,l,i,c,u]}class Wt extends ce{constructor(e){super(),ue(this,e,Ht,jt,ie,{message:0})}}function Jt(r){let e,n,t='<g fill="currentColor" fill-opacity="0"><path d="m15.22 6.03l2.53-1.94L14.56 4L13.5 1l-1.06 3l-3.19.09l2.53 1.94l-.91 3.06l2.63-1.81l2.63 1.81z"><animate id="lineMdMoonLoop0" fill="freeze" attributeName="fill-opacity" begin="0.7s;lineMdMoonLoop0.begin+6s" dur="0.4s" values="0;1"/><animate fill="freeze" attributeName="fill-opacity" begin="lineMdMoonLoop0.begin+2.2s" dur="0.4s" values="1;0"/></path><path d="M13.61 5.25L15.25 4l-2.06-.05L12.5 2l-.69 1.95L9.75 4l1.64 1.25l-.59 1.98l1.7-1.17l1.7 1.17z"><animate fill="freeze" attributeName="fill-opacity" begin="lineMdMoonLoop0.begin+3s" dur="0.4s" values="0;1"/><animate fill="freeze" attributeName="fill-opacity" begin="lineMdMoonLoop0.begin+5.2s" dur="0.4s" values="1;0"/></path><path d="M19.61 12.25L21.25 11l-2.06-.05L18.5 9l-.69 1.95l-2.06.05l1.64 1.25l-.59 1.98l1.7-1.17l1.7 1.17z"><animate fill="freeze" attributeName="fill-opacity" begin="lineMdMoonLoop0.begin+0.4s" dur="0.4s" values="0;1"/><animate fill="freeze" attributeName="fill-opacity" begin="lineMdMoonLoop0.begin+2.8s" dur="0.4s" values="1;0"/></path><path d="m20.828 9.731l1.876-1.439l-2.366-.067L19.552 6l-.786 2.225l-2.366.067l1.876 1.439L17.601 12l1.951-1.342L21.503 12z"><animate fill="freeze" attributeName="fill-opacity" begin="lineMdMoonLoop0.begin+3.4s" dur="0.4s" values="0;1"/><animate fill="freeze" attributeName="fill-opacity" begin="lineMdMoonLoop0.begin+5.6s" dur="0.4s" values="1;0"/></path></g><path fill="none" stroke="currentColor" stroke-dasharray="56" stroke-dashoffset="56" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 6 C7 12.08 11.92 17 18 17 C18.53 17 19.05 16.96 19.56 16.89 C17.95 19.36 15.17 21 12 21 C7.03 21 3 16.97 3 12 C3 8.83 4.64 6.05 7.11 4.44 C7.04 4.95 7 5.47 7 6 Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.6s" values="56;0"/></path>',s=[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},r[0]],l={};for(let o=0;o<s.length;o+=1)l=Se(l,s[o]);return{c(){e=rt("svg"),n=new ot(!0),this.h()},l(o){e=at(o,"svg",{viewBox:!0,width:!0,height:!0});var a=$(e);n=it(a,!0),a.forEach(_),this.h()},h(){n.a=null,Pe(e,l)},m(o,a){k(o,e,a),n.m(t,e)},p(o,[a]){Pe(e,l=pt(s,[{viewBox:"0 0 24 24"},{width:"1.2em"},{height:"1.2em"},a&1&&o[0]]))},i:V,o:V,d(o){o&&_(e)}}}function Xt(r,e,n){return r.$$set=t=>{n(0,e=Se(Se({},e),Le(t)))},e=Le(e),[e]}class Kt extends ce{constructor(e){super(),ue(this,e,Xt,Jt,ie,{})}}function Ye(r,e,n){const t=r.slice();return t[9]=e[n],t[11]=n,t}function je(r,e,n){const t=r.slice();return t[12]=e[n],t}function Zt(r){let e,n,t=r[9].name+"",s;return{c(){e=b("div"),n=b("span"),s=Z(t),this.h()},l(l){e=v(l,"DIV",{class:!0});var o=$(e);n=v(o,"SPAN",{class:!0});var a=$(n);s=Q(a,t),a.forEach(_),o.forEach(_),this.h()},h(){g(n,"class","opacity-50 uppercase"),g(e,"class","divider mx-2")},m(l,o){k(l,e,o),p(e,n),p(n,s)},p(l,o){o&8&&t!==(t=l[9].name+"")&&ke(s,t)},i:V,o:V,d(l){l&&_(e)}}}function Qt(r){let e,n;return e=new Wt({props:{message:r[9]}}),{c(){j(e.$$.fragment)},l(t){X(e.$$.fragment,t)},m(t,s){H(e,t,s),n=!0},p(t,s){const l={};s&8&&(l.message=t[9]),e.$set(l)},i(t){n||(P(e.$$.fragment,t),n=!0)},o(t){R(e.$$.fragment,t),n=!1},d(t){W(e,t)}}}function en(r){let e,n,t,s,l,o,a,i,c,d=(r[9].role=="user"?r[2]:"Dreamcatcher")+"",u,h,f,m=Je(r[9].createdAt)+"",y,T,C,O,L,z,S;const I=[nn,tn],N=[];function x(w,Y){return w[9].role=="user"?0:1}s=x(r),l=N[s]=I[s](r);let M=ve(r[9].content.split(`
`)),E=[];for(let w=0;w<M.length;w+=1)E[w]=He(je(r,M,w));return{c(){e=b("article"),n=b("div"),t=b("div"),l.c(),o=D(),a=b("div"),i=b("div"),c=b("p"),u=Z(d),h=D(),f=b("time"),y=Z(m),T=D(),C=b("div"),O=D();for(let w=0;w<E.length;w+=1)E[w].c();L=D(),this.h()},l(w){e=v(w,"ARTICLE",{class:!0});var Y=$(e);n=v(Y,"DIV",{class:!0});var U=$(n);t=v(U,"DIV",{class:!0});var K=$(t);l.l(K),K.forEach(_),U.forEach(_),o=G(Y),a=v(Y,"DIV",{class:!0});var J=$(a);i=v(J,"DIV",{class:!0});var ye=$(i);c=v(ye,"P",{class:!0});var se=$(c);u=Q(se,d),se.forEach(_),h=G(ye),f=v(ye,"TIME",{class:!0});var Ee=$(f);y=Q(Ee,m),Ee.forEach(_),ye.forEach(_),T=G(J),C=v(J,"DIV",{class:!0}),$(C).forEach(_),O=G(J);for(let ne=0;ne<E.length;ne+=1)E[ne].l(J);J.forEach(_),L=G(Y),Y.forEach(_),this.h()},h(){g(t,"class","w-10 rounded-full flex items-center justify-center"),g(n,"class","hidden md:flex chat-image avatar"),g(c,"class","font-bold"),g(f,"class","text-xs opacity-50"),g(i,"class","flex gap-2 items-center"),g(C,"class","divider divider-neutral my-0"),g(a,"class","chat-bubble bg-base-300 max-w-[90ch]"),g(e,"class",z="chat "+(r[9].role=="user"?"chat-end ml-2":"chat-start mr-2"))},m(w,Y){k(w,e,Y),p(e,n),p(n,t),N[s].m(t,null),p(e,o),p(e,a),p(a,i),p(i,c),p(c,u),p(i,h),p(i,f),p(f,y),p(a,T),p(a,C),p(a,O);for(let U=0;U<E.length;U+=1)E[U]&&E[U].m(a,null);p(e,L),S=!0},p(w,Y){let U=s;if(s=x(w),s===U?N[s].p(w,Y):(Ie(),R(N[U],1,1,()=>{N[U]=null}),Ce(),l=N[s],l?l.p(w,Y):(l=N[s]=I[s](w),l.c()),P(l,1),l.m(t,null)),(!S||Y&12)&&d!==(d=(w[9].role=="user"?w[2]:"Dreamcatcher")+"")&&ke(u,d),(!S||Y&8)&&m!==(m=Je(w[9].createdAt)+"")&&ke(y,m),Y&8){M=ve(w[9].content.split(`
`));let K;for(K=0;K<M.length;K+=1){const J=je(w,M,K);E[K]?E[K].p(J,Y):(E[K]=He(J),E[K].c(),E[K].m(a,null))}for(;K<E.length;K+=1)E[K].d(1);E.length=M.length}(!S||Y&8&&z!==(z="chat "+(w[9].role=="user"?"chat-end ml-2":"chat-start mr-2")))&&g(e,"class",z)},i(w){S||(P(l),S=!0)},o(w){R(l),S=!1},d(w){w&&_(e),N[s].d(),Re(E,w)}}}function tn(r){let e,n;return e=new Kt({props:{class:"text-2xl md:text-3xl ml-2"}}),{c(){j(e.$$.fragment)},l(t){X(e.$$.fragment,t)},m(t,s){H(e,t,s),n=!0},p:V,i(t){n||(P(e.$$.fragment,t),n=!0)},o(t){R(e.$$.fragment,t),n=!1},d(t){W(e,t)}}}function nn(r){let e,n;return{c(){e=b("img"),this.h()},l(t){e=v(t,"IMG",{alt:!0,src:!0}),this.h()},h(){var t,s;g(e,"alt","Tailwind CSS chat bubble component"),we(e.src,n=(s=(t=r[0])==null?void 0:t.user)==null?void 0:s.imageUrl)||g(e,"src",n)},m(t,s){k(t,e,s)},p(t,s){var l,o;s&1&&!we(e.src,n=(o=(l=t[0])==null?void 0:l.user)==null?void 0:o.imageUrl)&&g(e,"src",n)},i:V,o:V,d(t){t&&_(e)}}}function He(r){let e,n=r[12]+"",t;return{c(){e=b("p"),t=Z(n),this.h()},l(s){e=v(s,"P",{class:!0});var l=$(e);t=Q(l,n),l.forEach(_),this.h()},h(){g(e,"class","my-2")},m(s,l){k(s,e,l),p(e,t)},p(s,l){l&8&&n!==(n=s[12]+"")&&ke(t,n)},d(s){s&&_(e)}}}function We(r){let e,n,t,s;const l=[en,Qt,Zt],o=[];function a(i,c){return i[9].role!="system"?0:i[9].name=="image"?1:i[9].name!="hidden message"?2:-1}return~(e=a(r))&&(n=o[e]=l[e](r)),{c(){n&&n.c(),t=ae()},l(i){n&&n.l(i),t=ae()},m(i,c){~e&&o[e].m(i,c),k(i,t,c),s=!0},p(i,c){let d=e;e=a(i),e===d?~e&&o[e].p(i,c):(n&&(Ie(),R(o[d],1,1,()=>{o[d]=null}),Ce()),~e?(n=o[e],n?n.p(i,c):(n=o[e]=l[e](i),n.c()),P(n,1),n.m(t.parentNode,t)):n=null)},i(i){s||(P(n),s=!0)},o(i){R(n),s=!1},d(i){i&&_(t),~e&&o[e].d(i)}}}function sn(r){let e,n,t,s=ve(r[3]),l=[];for(let a=0;a<s.length;a+=1)l[a]=We(Ye(r,s,a));const o=a=>R(l[a],1,1,()=>{l[a]=null});return{c(){e=b("section"),n=b("section");for(let a=0;a<l.length;a+=1)l[a].c();this.h()},l(a){e=v(a,"SECTION",{class:!0});var i=$(e);n=v(i,"SECTION",{class:!0});var c=$(n);for(let d=0;d<l.length;d+=1)l[d].l(c);c.forEach(_),i.forEach(_),this.h()},h(){g(n,"class","overflow-scroll"),g(e,"class","border-2 rounded-lg border-base-100 flex min-h-[220px] flex-1 flex-col justify-end text-sm md:text-base join-item")},m(a,i){k(a,e,i),p(e,n);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(n,null);r[5](n),t=!0},p(a,[i]){if(i&13){s=ve(a[3]);let c;for(c=0;c<s.length;c+=1){const d=Ye(a,s,c);l[c]?(l[c].p(d,i),P(l[c],1)):(l[c]=We(d),l[c].c(),P(l[c],1),l[c].m(n,null))}for(Ie(),c=s.length;c<l.length;c+=1)o(c);Ce()}},i(a){if(!t){for(let i=0;i<s.length;i+=1)P(l[i]);t=!0}},o(a){l=l.filter(Boolean);for(let i=0;i<l.length;i+=1)R(l[i]);t=!1},d(a){a&&_(e),Re(l,a),r[5](null)}}}function Je(r){try{return Intl.DateTimeFormat("en-au",{dateStyle:"long"}).format(r)}catch{return""}}function ln(r,e,n){let t,s,l,o;A(r,oe,h=>n(7,s=h)),A(r,gt,h=>n(0,l=h));let a,i=0;const{messages:c}=be();A(r,c,h=>n(3,o=h));const d=()=>a==null?void 0:a.scroll({top:a.scrollHeight,behavior:"smooth"});ut(()=>{var h,f;(i=0)&&d(),!(((h=s==null?void 0:s.messageList)==null?void 0:h.length)<=i)&&(d(),i=(f=s==null?void 0:s.messageList)==null?void 0:f.length)}),dt(()=>{te({messageList:s.messageList.filter(h=>h.name!="Cover Image updated")})});function u(h){ft[h?"unshift":"push"](()=>{a=h,n(1,a)})}return r.$$.update=()=>{var h,f;r.$$.dirty&1&&n(2,t=((h=l==null?void 0:l.user)==null?void 0:h.firstName)||"@"+((f=l==null?void 0:l.user)==null?void 0:f.username)||"You")},[l,a,t,o,c,u]}class rn extends ce{constructor(e){super(),ue(this,e,ln,sn,ie,{})}}function Xe(r){let e,n,t,s;return{c(){e=b("textarea"),this.h()},l(l){e=v(l,"TEXTAREA",{class:!0,placeholder:!0}),$(e).forEach(_),this.h()},h(){g(e,"class","textarea textarea-xs focus:outline-none focus:border-none text-base join-item resize-none max-h-80 h-16"),g(e,"placeholder",n=r[2].length==0?"Describe your dream":"Discuss your dream")},m(l,o){k(l,e,o),r[7](e),B(e,r[3]),t||(s=[q(e,"focus",r[6]),q(e,"focusout",r[6]),q(e,"input",r[6]),q(e,"input",r[8])],t=!0)},p(l,o){o&4&&n!==(n=l[2].length==0?"Describe your dream":"Discuss your dream")&&g(e,"placeholder",n),o&8&&B(e,l[3])},d(l){l&&_(e),r[7](null),t=!1,Te(s)}}}function on(r){let e,n=(r[1]=="INTERPRETING"||r[1]=="STORY_PUBLISHED")&&Xe(r);return{c(){n&&n.c(),e=ae()},l(t){n&&n.l(t),e=ae()},m(t,s){n&&n.m(t,s),k(t,e,s)},p(t,[s]){t[1]=="INTERPRETING"||t[1]=="STORY_PUBLISHED"?n?n.p(t,s):(n=Xe(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:V,o:V,d(t){t&&_(e),n&&n.d(t)}}}function an(r,e,n){let t,s,l;A(r,fe,h=>n(1,t=h));const{messages:o,input:a}=be();A(r,o,h=>n(2,s=h)),A(r,a,h=>n(3,l=h));let i;function c(){i.value&&(n(0,i.style.height="64px",i),document.activeElement===i&&n(0,i.style.height=i.scrollHeight+3+"px",i))}function d(h){ft[h?"unshift":"push"](()=>{i=h,n(0,i)})}function u(){l=this.value,a.set(l)}return[i,t,s,l,o,a,c,d,u]}class cn extends ce{constructor(e){super(),ue(this,e,an,on,ie,{})}}function Ke(r){let e,n,t,s,l,o="Wholesome",a,i="Scary",c,d="Funny",u,h="Sad",f,m="Mysterious",y,T="Fantastical",C,O="Romantic",L,z="Gloomy",S,I,N,x,M,E="Medieval",w,Y="Futuristic",U,K="Fantasy",J,ye="Historical",se,Ee="Post Apocalypse",ne,Me="Magical Realm",de,De="Mysterious Location",me,Ge="Outer Space",he,Ve="Secluded Island",pe,Be="Vast desert",_e,Fe="Dense Jungle",Ae,Ue;return{c(){e=b("section"),n=b("input"),t=D(),s=b("datalist"),l=b("option"),l.textContent=o,a=b("option"),a.textContent=i,c=b("option"),c.textContent=d,u=b("option"),u.textContent=h,f=b("option"),f.textContent=m,y=b("option"),y.textContent=T,C=b("option"),C.textContent=O,L=b("option"),L.textContent=z,S=D(),I=b("input"),N=D(),x=b("datalist"),M=b("option"),M.textContent=E,w=b("option"),w.textContent=Y,U=b("option"),U.textContent=K,J=b("option"),J.textContent=ye,se=b("option"),se.textContent=Ee,ne=b("option"),ne.textContent=Me,de=b("option"),de.textContent=De,me=b("option"),me.textContent=Ge,he=b("option"),he.textContent=Ve,pe=b("option"),pe.textContent=Be,_e=b("option"),_e.textContent=Fe,this.h()},l(le){e=v(le,"SECTION",{class:!0});var ee=$(e);n=v(ee,"INPUT",{type:!0,placeholder:!0,list:!0,class:!0,name:!0}),t=G(ee),s=v(ee,"DATALIST",{id:!0});var ge=$(s);l=v(ge,"OPTION",{"data-svelte-h":!0}),F(l)!=="svelte-q5wm1n"&&(l.textContent=o),a=v(ge,"OPTION",{"data-svelte-h":!0}),F(a)!=="svelte-9l99qq"&&(a.textContent=i),c=v(ge,"OPTION",{"data-svelte-h":!0}),F(c)!=="svelte-7op4ae"&&(c.textContent=d),u=v(ge,"OPTION",{"data-svelte-h":!0}),F(u)!=="svelte-rjb7qi"&&(u.textContent=h),f=v(ge,"OPTION",{"data-svelte-h":!0}),F(f)!=="svelte-1kloxrm"&&(f.textContent=m),y=v(ge,"OPTION",{"data-svelte-h":!0}),F(y)!=="svelte-wtgm42"&&(y.textContent=T),C=v(ge,"OPTION",{"data-svelte-h":!0}),F(C)!=="svelte-1kcoejb"&&(C.textContent=O),L=v(ge,"OPTION",{"data-svelte-h":!0}),F(L)!=="svelte-1d68jjj"&&(L.textContent=z),ge.forEach(_),S=G(ee),I=v(ee,"INPUT",{type:!0,placeholder:!0,list:!0,class:!0,name:!0}),N=G(ee),x=v(ee,"DATALIST",{id:!0});var re=$(x);M=v(re,"OPTION",{"data-svelte-h":!0}),F(M)!=="svelte-1gu9y67"&&(M.textContent=E),w=v(re,"OPTION",{"data-svelte-h":!0}),F(w)!=="svelte-c06w1w"&&(w.textContent=Y),U=v(re,"OPTION",{"data-svelte-h":!0}),F(U)!=="svelte-188b67k"&&(U.textContent=K),J=v(re,"OPTION",{"data-svelte-h":!0}),F(J)!=="svelte-2y0vnk"&&(J.textContent=ye),se=v(re,"OPTION",{"data-svelte-h":!0}),F(se)!=="svelte-1r1nxkx"&&(se.textContent=Ee),ne=v(re,"OPTION",{"data-svelte-h":!0}),F(ne)!=="svelte-1kgvx0x"&&(ne.textContent=Me),de=v(re,"OPTION",{"data-svelte-h":!0}),F(de)!=="svelte-in3zx5"&&(de.textContent=De),me=v(re,"OPTION",{"data-svelte-h":!0}),F(me)!=="svelte-th025d"&&(me.textContent=Ge),he=v(re,"OPTION",{"data-svelte-h":!0}),F(he)!=="svelte-ifn2uu"&&(he.textContent=Ve),pe=v(re,"OPTION",{"data-svelte-h":!0}),F(pe)!=="svelte-1okmyx3"&&(pe.textContent=Be),_e=v(re,"OPTION",{"data-svelte-h":!0}),F(_e)!=="svelte-1qmlu3g"&&(_e.textContent=Fe),re.forEach(_),ee.forEach(_),this.h()},h(){g(n,"type","text"),g(n,"placeholder","Mood (Optional)"),g(n,"list","moods"),g(n,"class","input"),g(n,"name","mood"),n.disabled=r[1],l.__value="Wholesome",B(l,l.__value),a.__value="Scary",B(a,a.__value),c.__value="Funny",B(c,c.__value),u.__value="Sad",B(u,u.__value),f.__value="Mysterious",B(f,f.__value),y.__value="Fantastical",B(y,y.__value),C.__value="Romantic",B(C,C.__value),L.__value="Gloomy",B(L,L.__value),g(s,"id","moods"),g(I,"type","text"),g(I,"placeholder","Setting (Optional)"),g(I,"list","settings"),g(I,"class","input"),g(I,"name","setting"),I.disabled=r[1],M.__value="Medieval",B(M,M.__value),w.__value="Futuristic",B(w,w.__value),U.__value="Fantasy",B(U,U.__value),J.__value="Historical",B(J,J.__value),se.__value="Post Apocalypse",B(se,se.__value),ne.__value="Magical Realm",B(ne,ne.__value),de.__value="Mysterious Location",B(de,de.__value),me.__value="Outer Space",B(me,me.__value),he.__value="Secluded Island",B(he,he.__value),pe.__value="Vast desert",B(pe,pe.__value),_e.__value="Dense Jungle",B(_e,_e.__value),g(x,"id","settings"),g(e,"class","grid grid-cols-2 gap-2 md:gap-4 h-min")},m(le,ee){k(le,e,ee),p(e,n),B(n,r[2].story.mood),p(e,t),p(e,s),p(s,l),p(s,a),p(s,c),p(s,u),p(s,f),p(s,y),p(s,C),p(s,L),p(e,S),p(e,I),B(I,r[2].story.setting),p(e,N),p(e,x),p(x,M),p(x,w),p(x,U),p(x,J),p(x,se),p(x,ne),p(x,de),p(x,me),p(x,he),p(x,pe),p(x,_e),Ae||(Ue=[q(n,"input",r[4]),q(I,"input",r[5])],Ae=!0)},p(le,ee){ee&2&&(n.disabled=le[1]),ee&4&&n.value!==le[2].story.mood&&B(n,le[2].story.mood),ee&2&&(I.disabled=le[1]),ee&4&&I.value!==le[2].story.setting&&B(I,le[2].story.setting)},d(le){le&&_(e),Ae=!1,Te(Ue)}}}function un(r){let e,n=r[0]=="CONVERSATION_OVER"&&Ke(r);return{c(){n&&n.c(),e=ae()},l(t){n&&n.l(t),e=ae()},m(t,s){n&&n.m(t,s),k(t,e,s)},p(t,[s]){t[0]=="CONVERSATION_OVER"?n?n.p(t,s):(n=Ke(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:V,o:V,d(t){t&&_(e),n&&n.d(t)}}}function fn(r,e,n){let t,s,l;A(r,fe,c=>n(0,t=c)),A(r,oe,c=>n(2,l=c));const{isLoading:o}=be();A(r,o,c=>n(1,s=c));function a(){l.story.mood=this.value,oe.set(l)}function i(){l.story.setting=this.value,oe.set(l)}return[t,s,l,o,a,i]}class dn extends ce{constructor(e){super(),ue(this,e,fn,un,ie,{})}}function Ze(r,e,n){const t=r.slice();return t[8]=e[n],t[10]=n,t}function Qe(r){let e,n=r[8]+"",t;return{c(){e=b("p"),t=Z(n),this.h()},l(s){e=v(s,"P",{class:!0});var l=$(e);t=Q(l,n),l.forEach(_),this.h()},h(){g(e,"class","py-1")},m(s,l){k(s,e,l),p(e,t)},p(s,l){l&1&&n!==(n=s[8]+"")&&ke(t,n)},d(s){s&&_(e)}}}function mn(r){let e,n,t,s,l,o,a=`<span class="font-bold text-success">Note:</span> Your conversation history with the dream interpreter
			will remain stored on your device only.`,i,c,d,u,h,f,m,y,T,C,O,L,z=ve(r[0].story.story.split(`
`)),S=[];for(let I=0;I<z.length;I+=1)S[I]=Qe(Ze(r,z,I));return{c(){e=b("section"),n=b("article");for(let I=0;I<S.length;I+=1)S[I].c();t=D(),s=b("div"),l=D(),o=b("p"),o.innerHTML=a,i=D(),c=b("div"),d=b("label"),u=b("input"),f=Z(`
				Share story`),m=D(),y=b("form"),T=b("button"),C=Z("Save"),this.h()},l(I){e=v(I,"SECTION",{class:!0});var N=$(e);n=v(N,"ARTICLE",{class:!0});var x=$(n);for(let U=0;U<S.length;U+=1)S[U].l(x);x.forEach(_),t=G(N),s=v(N,"DIV",{class:!0}),$(s).forEach(_),l=G(N),o=v(N,"P",{class:!0,"data-svelte-h":!0}),F(o)!=="svelte-1ik1wgy"&&(o.innerHTML=a),i=G(N),c=v(N,"DIV",{class:!0});var M=$(c);d=v(M,"LABEL",{for:!0,class:!0});var E=$(d);u=v(E,"INPUT",{type:!0,name:!0,id:!0,class:!0}),f=Q(E,`
				Share story`),E.forEach(_),m=G(M),y=v(M,"FORM",{method:!0});var w=$(y);T=v(w,"BUTTON",{class:!0});var Y=$(T);C=Q(Y,"Save"),Y.forEach(_),w.forEach(_),M.forEach(_),N.forEach(_),this.h()},h(){var I,N;g(n,"class","my-2 max-h-80 overflow-scroll"),g(s,"class","divider divider-neutral mt-2"),g(o,"class","italic opacity-80"),g(u,"type","checkbox"),g(u,"name","share"),g(u,"id","share"),g(u,"class","toggle toggle-success"),u.checked=r[2],u.disabled=h=!r[0].story.title||!((N=(I=r[0])==null?void 0:I.image)!=null&&N.url),g(d,"for","share"),g(d,"class","flex items-center gap-4 cursor-pointer label"),T.disabled=r[1],g(T,"class","btn btn-success"),g(y,"method","dialog"),g(c,"class","flex items-end justify-between"),g(e,"class","gap-2 pb-4 max-w-full")},m(I,N){k(I,e,N),p(e,n);for(let x=0;x<S.length;x+=1)S[x]&&S[x].m(n,null);p(e,t),p(e,s),p(e,l),p(e,o),p(e,i),p(e,c),p(c,d),p(d,u),p(d,f),p(c,m),p(c,y),p(y,T),p(T,C),O||(L=[q(u,"click",r[6]),q(T,"click",r[4])],O=!0)},p(I,N){var x,M;if(N&1){z=ve(I[0].story.story.split(`
`));let E;for(E=0;E<z.length;E+=1){const w=Ze(I,z,E);S[E]?S[E].p(w,N):(S[E]=Qe(w),S[E].c(),S[E].m(n,null))}for(;E<S.length;E+=1)S[E].d(1);S.length=z.length}N&4&&(u.checked=I[2]),N&1&&h!==(h=!I[0].story.title||!((M=(x=I[0])==null?void 0:x.image)!=null&&M.url))&&(u.disabled=h),N&2&&(T.disabled=I[1])},d(I){I&&_(e),Re(S,I),O=!1,Te(L)}}}function hn(r){let e,n;return e=new Oe({props:{icon:"bi:save",slot:"logo"}}),{c(){j(e.$$.fragment)},l(t){X(e.$$.fragment,t)},m(t,s){H(e,t,s),n=!0},p:V,i(t){n||(P(e.$$.fragment,t),n=!0)},o(t){R(e.$$.fragment,t),n=!1},d(t){W(e,t)}}}function pn(r){let e,n="Save Story";return{c(){e=b("span"),e.textContent=n,this.h()},l(t){e=v(t,"SPAN",{class:!0,slot:!0,"data-svelte-h":!0}),F(e)!=="svelte-1xbbf7o"&&(e.textContent=n),this.h()},h(){g(e,"class","hidden md:flex"),g(e,"slot","button-text")},m(t,s){k(t,e,s)},p:V,d(t){t&&_(e)}}}function _n(r){let e,n;return e=new mt({props:{message:""}}),{c(){j(e.$$.fragment)},l(t){X(e.$$.fragment,t)},m(t,s){H(e,t,s),n=!0},p:V,i(t){n||(P(e.$$.fragment,t),n=!0)},o(t){R(e.$$.fragment,t),n=!1},d(t){W(e,t)}}}function gn(r){let e,n,t,s;return{c(){e=b("img"),this.h()},l(l){e=v(l,"IMG",{src:!0,alt:!0}),this.h()},h(){var l,o;we(e.src,n=(o=(l=r[0])==null?void 0:l.image)==null?void 0:o.url)||g(e,"src",n),g(e,"alt","cover")},m(l,o){k(l,e,o),t||(s=q(e,"error",r[5]),t=!0)},p(l,o){var a,i;o&1&&!we(e.src,n=(i=(a=l[0])==null?void 0:a.image)==null?void 0:i.url)&&g(e,"src",n)},i:V,o:V,d(l){l&&_(e),t=!1,s()}}}function bn(r){let e,n,t,s,l,o,a,i,c="Saving the story:",d,u,h;const f=[gn,_n],m=[];function y(T,C){var O,L;return(L=(O=T[0])==null?void 0:O.image)!=null&&L.url?0:1}return s=y(r),l=m[s]=f[s](r),u=new It({props:{title:r[0].story.title,fontSize:"text-2xl",fontColor:"text-success"}}),{c(){e=b("div"),n=b("div"),t=b("div"),l.c(),o=D(),a=b("div"),i=b("div"),i.textContent=c,d=D(),j(u.$$.fragment),this.h()},l(T){e=v(T,"DIV",{class:!0,slot:!0});var C=$(e);n=v(C,"DIV",{class:!0});var O=$(n);t=v(O,"DIV",{class:!0});var L=$(t);l.l(L),L.forEach(_),O.forEach(_),o=G(C),a=v(C,"DIV",{});var z=$(a);i=v(z,"DIV",{class:!0,"data-svelte-h":!0}),F(i)!=="svelte-1quo1eb"&&(i.textContent=c),d=G(z),X(u.$$.fragment,z),z.forEach(_),C.forEach(_),this.h()},h(){g(t,"class","mask mask-squircle w-24 h-24"),g(n,"class","avatar"),g(i,"class","text-lg opacity-50"),g(e,"class","flex items-center gap-3"),g(e,"slot","title")},m(T,C){k(T,e,C),p(e,n),p(n,t),m[s].m(t,null),p(e,o),p(e,a),p(a,i),p(a,d),H(u,a,null),h=!0},p(T,C){let O=s;s=y(T),s===O?m[s].p(T,C):(Ie(),R(m[O],1,1,()=>{m[O]=null}),Ce(),l=m[s],l?l.p(T,C):(l=m[s]=f[s](T),l.c()),P(l,1),l.m(t,null));const L={};C&1&&(L.title=T[0].story.title),u.$set(L)},i(T){h||(P(l),P(u.$$.fragment,T),h=!0)},o(T){R(l),R(u.$$.fragment,T),h=!1},d(T){T&&_(e),m[s].d(),W(u)}}}function vn(r){let e,n;return e=new ht({props:{buttonText:"",noAnimate:!0,busy:r[3]||!r[0].story.title,$$slots:{title:[bn],"button-text":[pn],logo:[hn],default:[mn]},$$scope:{ctx:r}}}),{c(){j(e.$$.fragment)},l(t){X(e.$$.fragment,t)},m(t,s){H(e,t,s),n=!0},p(t,[s]){const l={};s&9&&(l.busy=t[3]||!t[0].story.title),s&2055&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(P(e.$$.fragment,t),n=!0)},o(t){R(e.$$.fragment,t),n=!1},d(t){W(e,t)}}}function yn(r,e,n){let t,s,l,o;A(r,oe,u=>n(0,s=u)),A(r,gt,u=>n(7,l=u)),A(r,$e,u=>n(3,o=u));let a=!1;async function i(){var T;if(n(1,a=!0),!s.image.url)return;const[u,h]=await bt("/api/image/upload",{method:"POST",body:{url:s.image.url}});if(h){console.log(h);return}const f={authorId:(T=l==null?void 0:l.user)==null?void 0:T.id,title:s.story.title,story:s.story.story,imageUrl:u.url,shared:t};n(1,a=!1);const y=await(await fetch("/api/stories",{method:"POST",body:JSON.stringify(f),headers:{"Content-Type":"application/json"}})).json();wt(y),te({id:`${y}`,finalImageUrl:u.url,lastState:"STORY_PUBLISHED",shared:t}),$t(`/story/${y}`,{replaceState:!0})}const c=()=>te({image:{...s.image,url:""}}),d=()=>n(2,t=!t);return r.$$.update=()=>{r.$$.dirty&1&&n(2,t=s==null?void 0:s.shared)},[s,a,t,o,i,c,d]}class Tn extends ce{constructor(e){super(),ue(this,e,yn,vn,ie,{})}}function et(r){let e,n,t,s,l,o,a,i,c="Generate Title",d,u,h,f,m,y="New Image",T,C,O,L,z;return o=new Oe({props:{icon:"charm:refresh",class:"text-lg"}}),h=new Oe({props:{icon:"ph:image",class:"text-lg"}}),C=new Tn({}),{c(){e=b("section"),n=b("article"),t=b("input"),s=D(),l=b("button"),j(o.$$.fragment),a=D(),i=b("span"),i.textContent=c,d=D(),u=b("button"),j(h.$$.fragment),f=D(),m=b("span"),m.textContent=y,T=D(),j(C.$$.fragment),this.h()},l(S){e=v(S,"SECTION",{class:!0});var I=$(e);n=v(I,"ARTICLE",{class:!0});var N=$(n);t=v(N,"INPUT",{type:!0,class:!0,placeholder:!0}),s=G(N),l=v(N,"BUTTON",{class:!0});var x=$(l);X(o.$$.fragment,x),a=G(x),i=v(x,"SPAN",{class:!0,"data-svelte-h":!0}),F(i)!=="svelte-1jqhjgc"&&(i.textContent=c),x.forEach(_),N.forEach(_),d=G(I),u=v(I,"BUTTON",{class:!0});var M=$(u);X(h.$$.fragment,M),f=G(M),m=v(M,"SPAN",{class:!0,"data-svelte-h":!0}),F(m)!=="svelte-pzyt9o"&&(m.textContent=y),M.forEach(_),T=G(I),X(C.$$.fragment,I),I.forEach(_),this.h()},h(){g(t,"type","text"),g(t,"class","join-item input flex-1 max-w-36 md:max-w-full"),g(t,"placeholder","Title"),t.disabled=r[2],g(i,"class","hidden md:flex"),l.disabled=r[2],g(l,"class","btn animate-none rounded-l-none"),g(n,"class","flex rounded-xl"),g(m,"class","hidden md:flex"),u.disabled=r[2],g(u,"class","btn animate-none"),g(e,"class","flex gap-2")},m(S,I){k(S,e,I),p(e,n),p(n,t),B(t,r[0].story.title),p(n,s),p(n,l),H(o,l,null),p(l,a),p(l,i),p(e,d),p(e,u),H(h,u,null),p(u,f),p(u,m),p(e,T),H(C,e,null),O=!0,L||(z=[q(t,"input",r[7]),q(t,"change",r[6]),q(l,"click",r[5]),q(u,"click",r[4])],L=!0)},p(S,I){(!O||I&4)&&(t.disabled=S[2]),I&1&&t.value!==S[0].story.title&&B(t,S[0].story.title),(!O||I&4)&&(l.disabled=S[2]),(!O||I&4)&&(u.disabled=S[2])},i(S){O||(P(o.$$.fragment,S),P(h.$$.fragment,S),P(C.$$.fragment,S),O=!0)},o(S){R(o.$$.fragment,S),R(h.$$.fragment,S),R(C.$$.fragment,S),O=!1},d(S){S&&_(e),W(o),W(h),W(C),L=!1,Te(z)}}}function In(r){let e,n,t=r[1]=="FINALISING_STORY"&&et(r);return{c(){t&&t.c(),e=ae()},l(s){t&&t.l(s),e=ae()},m(s,l){t&&t.m(s,l),k(s,e,l),n=!0},p(s,[l]){s[1]=="FINALISING_STORY"?t?(t.p(s,l),l&2&&P(t,1)):(t=et(s),t.c(),P(t,1),t.m(e.parentNode,e)):t&&(Ie(),R(t,1,1,()=>{t=null}),Ce())},i(s){n||(P(t),n=!0)},o(s){R(t),n=!1},d(s){s&&_(e),t&&t.d(s)}}}function Cn(r,e,n){let t,s,l,o;A(r,oe,f=>n(0,t=f)),A(r,fe,f=>n(1,l=f)),A(r,$e,f=>n(2,o=f));const{messages:a,setMessages:i}=be();A(r,a,f=>n(8,s=f));async function c(){const f=_t();i([...s,{id:f,content:"Generating Image",name:"image",role:"system"}]);const{mood:m,setting:y}=t.story;$e.set(!0);const T=await Pt(s,m,y);if(!T){console.warn(T);return}const[C,O]=await bt("/api/image",{method:"POST",body:{prompt:Et+" "+T}});if($e.set(!1),O||!C.url){console.warn(O),console.log("error triggered !!!!!!!!!!!!");return}i(s.map(L=>L.id==f?{...L,content:C.url,id:C.created}:L)),te({image:{url:C.url,created:C.created}})}async function d(){var T;$e.set(!0);const[f,m]=await vt("Generate a short 3-5 word title for the story.",s);if(m){console.warn(m);return}const y=(T=f==null?void 0:f.choices[0].message.content)==null?void 0:T.replaceAll('"',"");te({story:{...t.story,title:y}}),$e.set(!1)}function u(f){const m=f.target;te({story:{...t.story,title:m.value}})}function h(){t.story.title=this.value,oe.set(t)}return[t,l,o,a,c,d,u,h]}class $n extends ce{constructor(e){super(),ue(this,e,Cn,In,ie,{})}}function tt(r,e,n){const t=r.slice();return t[11]=e[n],t[13]=n,t}function nt(r){let e,n,t,s,l,o,a=ve(Array(3)),i=[];for(let c=0;c<a.length;c+=1)i[c]=lt(tt(r,a,c));return{c(){e=b("section");for(let c=0;c<i.length;c+=1)i[c].c();n=D(),t=b("button"),s=Z("Wrap it up!"),this.h()},l(c){e=v(c,"SECTION",{class:!0});var d=$(e);for(let h=0;h<i.length;h+=1)i[h].l(d);n=G(d),t=v(d,"BUTTON",{class:!0});var u=$(t);s=Q(u,"Wrap it up!"),u.forEach(_),d.forEach(_),this.h()},h(){t.value="Wrap it up",t.disabled=r[2],g(t,"class","btn animate-none"),g(e,"class","flex gap-2")},m(c,d){k(c,e,d);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(e,null);p(e,n),p(e,t),p(t,s),l||(o=q(t,"click",r[5]),l=!0)},p(c,d){if(d&37){a=ve(Array(3));let u;for(u=0;u<a.length;u+=1){const h=tt(c,a,u);i[u]?i[u].p(h,d):(i[u]=lt(h),i[u].c(),i[u].m(e,n))}for(;u<i.length;u+=1)i[u].d(1);i.length=a.length}d&4&&(t.disabled=c[2])},d(c){c&&_(e),Re(i,c),l=!1,o()}}}function st(r){let e;return{c(){e=Z("Option")},l(n){e=Q(n,"Option")},m(n,t){k(n,e,t)},d(n){n&&_(e)}}}function lt(r){let e,n,t=r[13]+1+"",s,l,o,a=r[0]>=768&&st();return{c(){e=b("button"),a&&a.c(),n=D(),s=Z(t),this.h()},l(i){e=v(i,"BUTTON",{class:!0});var c=$(e);a&&a.l(c),n=G(c),s=Q(c,t),c.forEach(_),this.h()},h(){e.value="option "+(r[13]+1),e.disabled=r[2],g(e,"class","btn animate-none")},m(i,c){k(i,e,c),a&&a.m(e,null),p(e,n),p(e,s),l||(o=q(e,"click",r[5]),l=!0)},p(i,c){i[0]>=768?a||(a=st(),a.c(),a.m(e,n)):a&&(a.d(1),a=null),c&4&&(e.disabled=i[2])},d(i){i&&_(e),a&&a.d(),l=!1,o()}}}function Sn(r){let e,n,t;yt(r[6]);let s=r[1]=="GENERATING_CHAPTER_STORY"&&nt(r);return{c(){s&&s.c(),e=ae()},l(l){s&&s.l(l),e=ae()},m(l,o){s&&s.m(l,o),k(l,e,o),n||(t=q(window,"resize",r[6]),n=!0)},p(l,[o]){l[1]=="GENERATING_CHAPTER_STORY"?s?s.p(l,o):(s=nt(l),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},i:V,o:V,d(l){l&&_(e),s&&s.d(l),n=!1,t()}}}function wn(r,e,n){let t,s,l,o;A(r,oe,m=>n(7,t=m)),A(r,fe,m=>n(1,l=m));const{isLoading:a,messages:i,append:c}=be();A(r,a,m=>n(2,o=m)),A(r,i,m=>n(8,s=m));async function d(){const T=s.filter((C,O)=>C.role=="assistant"&&O>t.story.chapterIndexStart).map(C=>C.content.split("Choose your path:")[0]).join(`
`).replaceAll(`

`,`
`);te({story:{...t.story,story:T},lastState:"FINALISING_STORY"}),fe.set("FINALISING_STORY")}async function u(m){const{value:y}=m.target;await c(Ne(y,"hidden message")),y=="Wrap it up"&&d()}let h=0;function f(){n(0,h=window.innerWidth)}return[h,l,o,a,i,u,f]}class kn extends ce{constructor(e){super(),ue(this,e,wn,Sn,ie,{})}}function Nn(r){let e,n,t,s,l,o,a,i,c,d,u;return s=new Oe({props:{icon:"carbon:send",class:"text-xl"}}),i=new Oe({props:{icon:"carbon:book",class:"text-xl"}}),{c(){e=b("form"),n=b("button"),t=Z(`Send
        `),j(s.$$.fragment),l=D(),o=b("button"),a=Z(`Start Story
		`),j(i.$$.fragment),this.h()},l(h){e=v(h,"FORM",{class:!0});var f=$(e);n=v(f,"BUTTON",{class:!0});var m=$(n);t=Q(m,`Send
        `),X(s.$$.fragment,m),m.forEach(_),l=G(f),o=v(f,"BUTTON",{type:!0,class:!0});var y=$(o);a=Q(y,`Start Story
		`),X(i.$$.fragment,y),y.forEach(_),f.forEach(_),this.h()},h(){g(n,"class","btn"),n.disabled=r[0],g(o,"type","button"),g(o,"class","btn"),o.disabled=r[0],g(e,"class","flex gap-2 mr-2")},m(h,f){k(h,e,f),p(e,n),p(n,t),H(s,n,null),p(e,l),p(e,o),p(o,a),H(i,o,null),c=!0,d||(u=[q(n,"click",r[2]),q(o,"click",r[3]),q(e,"submit",r[2])],d=!0)},p(h,[f]){(!c||f&1)&&(n.disabled=h[0]),(!c||f&1)&&(o.disabled=h[0])},i(h){c||(P(s.$$.fragment,h),P(i.$$.fragment,h),c=!0)},o(h){R(s.$$.fragment,h),R(i.$$.fragment,h),c=!1},d(h){h&&_(e),W(s),W(i),d=!1,Te(u)}}}function En(r,e,n){let t,s;A(r,oe,c=>n(4,t=c));const{append:l,isLoading:o,handleSubmit:a}=be();A(r,o,c=>n(0,s=c));async function i(){t.messageList.length>3&&await l(Ne(xt,"Final Interpretation")),te({lastState:"CONVERSATION_OVER"}),fe.set("CONVERSATION_OVER")}return[s,o,a,i]}class On extends ce{constructor(e){super(),ue(this,e,En,Nn,ie,{})}}function xn(r){let e,n,t,s,l,o,a,i,c,d,u,h;return{c(){e=b("section"),n=b("button"),t=Z("Full Story"),s=D(),l=b("button"),o=Z("Choose your own adventure"),a=D(),i=b("button"),c=Z("Start!"),this.h()},l(f){e=v(f,"SECTION",{class:!0});var m=$(e);n=v(m,"BUTTON",{class:!0});var y=$(n);t=Q(y,"Full Story"),y.forEach(_),s=G(m),l=v(m,"BUTTON",{class:!0});var T=$(l);o=Q(T,"Choose your own adventure"),T.forEach(_),a=G(m),i=v(m,"BUTTON",{class:!0});var C=$(i);c=Q(C,"Start!"),C.forEach(_),m.forEach(_),this.h()},h(){n.value="fullStory",g(n,"class","btn flex-1 no-animation"),n.disabled=r[1],xe(n,"btn-secondary",r[0].story.type=="fullStory"),l.value="chapterStory",g(l,"class","btn flex-1 no-animation"),l.disabled=r[1],xe(l,"btn-secondary",r[0].story.type=="chapterStory"),i.disabled=d=!r[0].story.type||r[1],g(i,"class","btn flex-1 no-animation"),g(e,"class","flex flex-1 gap-2")},m(f,m){k(f,e,m),p(e,n),p(n,t),p(e,s),p(e,l),p(l,o),p(e,a),p(e,i),p(i,c),u||(h=[q(n,"click",r[5]),q(l,"click",r[5]),q(i,"click",r[4])],u=!0)},p(f,[m]){m&2&&(n.disabled=f[1]),m&1&&xe(n,"btn-secondary",f[0].story.type=="fullStory"),m&2&&(l.disabled=f[1]),m&1&&xe(l,"btn-secondary",f[0].story.type=="chapterStory"),m&3&&d!==(d=!f[0].story.type||f[1])&&(i.disabled=d)},i:V,o:V,d(f){f&&_(e),u=!1,Te(h)}}}function Pn(r,e,n){let t,s,l;A(r,oe,f=>n(0,t=f));const{messages:o,isLoading:a,append:i}=be();A(r,o,f=>n(6,s=f)),A(r,a,f=>n(1,l=f));function c(){var f;((f=t==null?void 0:t.story)==null?void 0:f.type)=="fullStory"?u():d(),te({story:{...t.story,chapterIndexStart:s.length-1}})}async function d(){var m,y;const f=Nt((m=t==null?void 0:t.story)==null?void 0:m.mood,(y=t==null?void 0:t.story)==null?void 0:y.setting);await i(Ne(f,"choose your own adventure story")),te({lastState:"GENERATING_CHAPTER_STORY"}),fe.set("GENERATING_CHAPTER_STORY")}async function u(){var y,T;const f=kt((y=t.story)==null?void 0:y.mood,(T=t.story)==null?void 0:T.setting);await i(Ne(f,"Your story"));const m=s.at(-1);m&&(te({story:{...t.story,story:m.content},lastState:"FINALISING_STORY"}),fe.set("FINALISING_STORY"))}function h(f){const m=f.target;te({story:{...t.story,type:m.value}})}return[t,l,o,a,c,h]}class Ln extends ce{constructor(e){super(),ue(this,e,Pn,xn,ie,{})}}function Rn(r){let e,n,t;var s=r[0];function l(o,a){return{}}return s&&(e=qe(s,l())),{c(){e&&j(e.$$.fragment),n=ae()},l(o){e&&X(e.$$.fragment,o),n=ae()},m(o,a){e&&H(e,o,a),k(o,n,a),t=!0},p(o,a){if(a&1&&s!==(s=o[0])){if(e){Ie();const i=e;R(i.$$.fragment,1,0,()=>{W(i,1)}),Ce()}s?(e=qe(s,l()),j(e.$$.fragment),P(e.$$.fragment,1),H(e,n.parentNode,n)):e=null}},i(o){t||(e&&P(e.$$.fragment,o),t=!0)},o(o){e&&R(e.$$.fragment,o),t=!1},d(o){o&&_(n),e&&W(e,o)}}}function An(r){let e,n,t,s,l,o,a,i;return e=new rn({}),t=new cn({}),l=new dn({}),a=new St({props:{journalPage:!0,$$slots:{default:[Rn]},$$scope:{ctx:r}}}),{c(){j(e.$$.fragment),n=D(),j(t.$$.fragment),s=D(),j(l.$$.fragment),o=D(),j(a.$$.fragment)},l(c){X(e.$$.fragment,c),n=G(c),X(t.$$.fragment,c),s=G(c),X(l.$$.fragment,c),o=G(c),X(a.$$.fragment,c)},m(c,d){H(e,c,d),k(c,n,d),H(t,c,d),k(c,s,d),H(l,c,d),k(c,o,d),H(a,c,d),i=!0},p(c,[d]){const u={};d&257&&(u.$$scope={dirty:d,ctx:c}),a.$set(u)},i(c){i||(P(e.$$.fragment,c),P(t.$$.fragment,c),P(l.$$.fragment,c),P(a.$$.fragment,c),i=!0)},o(c){R(e.$$.fragment,c),R(t.$$.fragment,c),R(l.$$.fragment,c),R(a.$$.fragment,c),i=!1},d(c){c&&(_(n),_(s),_(o)),W(e,c),W(t,c),W(l,c),W(a,c)}}}function Mn(r,e,n){let t,s,l;A(r,fe,u=>n(3,t=u)),A(r,oe,u=>n(4,s=u));const{input:o,messages:a,setMessages:i}=be();A(r,o,u=>n(5,l=u));const c={capture:()=>l,restore:u=>Tt(o,l=u,l)};ct(()=>{ze(),i(s==null?void 0:s.messageList),fe.set(s.lastState),a.subscribe(u=>{u.length>=s.messageList.length&&te({messageList:u})})}),ut(()=>{Ct.set(s.story.title||"Dream Journal")}),dt(()=>{ze(),i(s==null?void 0:s.messageList),fe.set(s.lastState)});let d;return r.$$.update=()=>{if(r.$$.dirty&8)switch(t){case"INTERPRETING":n(0,d=On);break;case"CONVERSATION_OVER":n(0,d=Ln);break;case"FINALISING_STORY":n(0,d=$n);break;case"GENERATING_CHAPTER_STORY":n(0,d=kn);break}},[d,o,c,t]}class Kn extends ce{constructor(e){super(),ue(this,e,Mn,An,ie,{snapshot:2})}get snapshot(){return this.$$.ctx[2]}}export{Kn as component,Xn as universal};
